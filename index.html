<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catálogo ACDelco (Datos Reales)</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
  h1 { color: #004aad; text-align: center; }
  select { padding: 10px; margin: 10px 0; width: 100%; max-width: 420px; }
  .resultado { margin-top: 20px; padding: 15px; background: #fff; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.1); max-width: 420px; }
  .hint { color:#666; font-size: 14px; }
</style>
</head>
<body>
<h1>Catálogo ACDelco</h1>
<div class="hint">Los datos se cargan desde <code>data.json</code>.</div>

<select id="categoria"><option value="">-- Selecciona Categoría --</option></select>
<select id="armadora" disabled><option value="">-- Selecciona Armadora --</option></select>
<select id="modelo" disabled><option value="">-- Selecciona Modelo --</option></select>
<select id="anio" disabled><option value="">-- Selecciona Año --</option></select>

<div class="resultado" id="resultado">Selecciona una categoría para empezar.</div>

<script>
let DATA = [];
let COLS = {
  categoria: "Categoría",
  armadora: "Armadora",
  modelo: "Modelo",
  anio: "Año",
  producto: "Producto",
  codigo: "Código",
  precio: "Precio"
};

const categoriaSelect = document.getElementById("categoria");
const armadoraSelect = document.getElementById("armadora");
const modeloSelect = document.getElementById("modelo");
const anioSelect = document.getElementById("anio");
const resultadoDiv = document.getElementById("resultado");

function unique(arr) { return Array.from(new Set(arr)).sort(); }
function val(r, k) { return (r[k] || '').toString().trim(); }

function fillCategorias() {
  const cats = unique(DATA.map(r => val(r, COLS.categoria)).filter(Boolean));
  categoriaSelect.innerHTML = '<option value="">-- Selecciona Categoría --</option>' + cats.map(c => `<option value="${c}">${c}</option>`).join('');
}

function onCategoriaChange() {
  armadoraSelect.innerHTML = '<option value="">-- Selecciona Armadora --</option>';
  modeloSelect.innerHTML = '<option value="">-- Selecciona Modelo --</option>';
  anioSelect.innerHTML = '<option value="">-- Selecciona Año --</option>';
  armadoraSelect.disabled = true; modeloSelect.disabled = true; anioSelect.disabled = true;
  resultadoDiv.textContent = "";
  const cat = categoriaSelect.value;
  if(cat) {
    const arms = unique(DATA
      .filter(r => val(r, COLS.categoria) === cat)
      .map(r => val(r, COLS.armadora))
      .filter(Boolean));
    armadoraSelect.innerHTML += arms.map(a => `<option value="${a}">${a}</option>`).join('');
    armadoraSelect.disabled = false;
  }
}

function onArmadoraChange() {
  modeloSelect.innerHTML = '<option value="">-- Selecciona Modelo --</option>';
  anioSelect.innerHTML = '<option value="">-- Selecciona Año --</option>';
  modeloSelect.disabled = true; anioSelect.disabled = true;
  resultadoDiv.textContent = "";
  const cat = categoriaSelect.value;
  const arm = armadoraSelect.value;
  if(arm) {
    const mods = unique(DATA
      .filter(r => val(r, COLS.categoria) === cat && val(r, COLS.armadora) === arm)
      .map(r => val(r, COLS.modelo))
      .filter(Boolean));
    modeloSelect.innerHTML += mods.map(m => `<option value="${m}">${m}</option>`).join('');
    modeloSelect.disabled = false;
  }
}

function onModeloChange() {
  anioSelect.innerHTML = '<option value="">-- Selecciona Año --</option>';
  anioSelect.disabled = true;
  resultadoDiv.textContent = "";
  const cat = categoriaSelect.value;
  const arm = armadoraSelect.value;
  const mod = modeloSelect.value;
  if(mod) {
    const years = unique(DATA
      .filter(r => val(r, COLS.categoria) === cat && val(r, COLS.armadora) === arm && val(r, COLS.modelo) === mod)
      .map(r => val(r, COLS.anio))
      .filter(Boolean));
    anioSelect.innerHTML += years.map(y => `<option value="${y}">${y}</option>`).join('');
    anioSelect.disabled = false;
  }
}

function onAnioChange() {
  const cat = categoriaSelect.value;
  const arm = armadoraSelect.value;
  const mod = modeloSelect.value;
  const year = anioSelect.value;
  const r = DATA.find(i =>
    val(i, COLS.categoria) === cat &&
    val(i, COLS.armadora) === arm &&
    val(i, COLS.modelo) === mod &&
    val(i, COLS.anio) === year
  );
  if(r) {
    resultadoDiv.innerHTML = `
      <strong>Producto:</strong> ${val(r, COLS.producto)}<br>
      <strong>Código:</strong> ${val(r, COLS.codigo)}<br>
      <strong>Precio:</strong> ${val(r, COLS.precio)}<br>
      <strong>Compatibilidad:</strong> ${val(r, COLS.armadora)} ${val(r, COLS.modelo)} ${val(r, COLS.anio)}
    `;
  } else {
    resultadoDiv.textContent = "No se encontró información.";
  }
}

categoriaSelect.addEventListener("change", onCategoriaChange);
armadoraSelect.addEventListener("change", onArmadoraChange);
modeloSelect.addEventListener("change", onModeloChange);
anioSelect.addEventListener("change", onAnioChange);

// Cargar data.json (debe estar en la raíz del repo)
fetch('data.json')
  .then(r => r.json())
  .then(json => { DATA = json; fillCategorias(); })
  .catch(err => {
    console.error(err);
    resultadoDiv.textContent = "No se pudo cargar data.json. Verifica que exista en el repositorio.";
  });
</script>
</body>
</html>
